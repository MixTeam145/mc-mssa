%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%                                                                 %%%
%%%     Санкт-Петербургский государственный университет             %%%
%%%     факультет Прикладной математики — процессов управления      %%%
%%%                                                                 %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%                                                                 %%%
%%%     Шаблон для подготовки статьи, набранной в пакете MikTeX,    %%%
%%%     для ежегодной конференции аспирантов и студентов            %%%
%%%                                                                 %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%                                                                 %%%
%%%                        ОСНОВНЫЕ ПРАВИЛА                         %%%
%%%                                                                 %%%
%%%     1. при оформлении основных элементов статьи следует         %%%
%%%        использовать ниже описанные конструкции                  %%%
%%%     2. изменять стилевой файл ЗАПРЕЩАЕТСЯ                       %%%
%%%                                                                 %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%                                                                 %%%
%%%     Дата последнего изменения: 10.02.2024                       %%%
%%%                                                                 %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[a4paper]{article}
\usepackage{pmstyle}
\usepackage{cite}

\usepackage{algorithm}
\usepackage{algpseudocode}

\include{letters_series_mathbb.tex}

\newtheorem{Algorithm}{Алгоритм}
\begin{document}
\hyphenation{СПбГУ}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%                     УДК | АВТОР | НАЗВАНИЕ СТАТЬИ               %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% УДК для статьи берется со страницы http://teacode.com/online/udc/
\udk{УДК}

%%%   Если у статьи 1 автор
%%%     Фамилия~И.\:О.
%\author{Фамилия~И.\:О.}

%%%   Если у статьи 2 и более автора
%%%     Фамилия~И.\:О.
\author{Потешкин~Е.\:П.}

%%%%%%%%%   Название статьи
\title{Выбор параметров в методе Монте-Карло SSA}

\renewcommand{\thefootnote}{ }
{\footnotetext{{\it Потешкин Егор Павлович} -- студент, Санкт-Петербургский государственный университет; email: egor.poteshkin@yandex.ru, тел.: +7(921)560-32-02}}

% если по ГРАНТУ
{\footnotetext{Работа выполнена при финансовой поддержке РНФ, проект № 23-21-00222}} % и/или СПбГУ, НИР № 0.00.000.0000}}

\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%                РЕКОМЕНДАЦИЯ К ПУБЛИКАЦИИ                %%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% Рекомендация научного руководителя (необходимо для студентов и аспирантов).

%%%% БЕЗ рекомендации
%\norec{}

%%%% Рекомендовано профессором ...
%\recprof{Утешевым~А.\:Ю.}

%%%% Рекомендовано доцентом ...
\recdotz{}

%%%% Рекомендовано старшим преподавателем ...
%\recsp{Ереминым~А.\:С.}

%%%% Рекомендовано ассистентом ...
%\recassist{Ереминым~А.\:С.}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\razdel{Введение}
Обнаружения сигнала в красном шуме (красным шумом называется процесс авторегрессии первого порядка с положительным коэффициентом) с целью его дальнейшего выделения является важной задачей, например для анализа поведения глобального потепления~\cite{cps23}. Одним из методов, используемым для этой цели, является метод Monte-Carlo SSA (MC-SSA)~\cite{AllenSmith96}, который проверяет гипотезу о том, что отсутствует сигнал, а в случае, если она отвергается, позволяет приближенно выделить этот сигнал. При использовании метода MC-SSA возникают следующие проблемы. Используемый на практике вариант критерия в методе MC-SSA является радикальным, поэтому для его использования необходимы поправки. В~\cite{Golyandina2023} предлагается поправка на множественное тестирование, частично исправляющая радикальность. Однако применяемая на практике модификация критерия все еще остается радикальной. Эту радикальность сложно исправить теоретически, поэтому используется метод эмпирической поправки критерия, основанный на оцененных ошибках первого рода в зависимости от уровня значимости, см., например,~\cite{cps22}, где этот подход используется в контексте метода MC-SSA.

Используемый в той же работе~\cite{cps22} подход через построение ROC-кривых позволяет сравнивать критерии по мощности. Соответственно возникает вопрос о выборе параметра метода MC-SSA, называемого длиной окна, дающего оптимальную мощность. Ответу на этот вопрос мешает то, что если исходно критерий сильно радикальный, то поправку, исправляющую радикальность, очень трудоемко или даже невозможно сделать.

Данная статья посвящена поиску длины окна, при которой критерий наиболее мощный среди не слишком радикальных критериев. 

В разделе 2 приведены известные результаты. В разделе 3 приведены результаты численного исследования зависимости ошибки первого рода и мощности от длины окна. На основе этих результатов в разделе 4 предложен алгоритм поиска длины окна и продемонстрирована его работа. 

\razdel{Известные результаты}
В этом разделе введем нужные обозначения и приведем известные результаты, чтобы в дальнейшем их использовать.
\podrazdel{SSA~\cite{ssa2001}}
Пусть $\tX=(x_1,\ldots,x_N)$, $x_i\in \mathbb{R}$, -- временной ряд длины $N$. Зафиксируем параметр $L$, $1<L<N$, называемый длиной окна. Построим матрицу $\bfX=[X_1:\ldots:X_K]$, состоящую из $K=N-L+1$ векторов вложения $X_i=(x_i,\ldots,x_{i+L-1})^\rmT\in \mathbb R^L$.

Следующий шаг -- разложение в сумму матриц единичного ранга $\bfX=\sum_{i=1}^d \bfX_i$. В базовом SSA используется сингулярное разложение матрицы $\bfX$.

Далее компоненты полученного матричного разложения разумно группируются, и каждая
сгруппированная матрица преобразуется во временной ряд. Таким образом, результатом SSA является
разложение временного ряда.
\podrazdel{Toeplitz SSA~\cite{ssa2001}}
Модификация базового SSA, Toeplitz SSA, использует вместо сингулярного разложения разложение матрицы $\bfX$, основанное на собственных векторах  $\{P_i\}_{i=1}^L$ тёплицевой матрицы $\bfC$ с элементами
\begin{equation}\label{eq:toeplitz}
    c_{ij} = \frac{1}{N - |i - j|}\sum_{m=1}^{N-|i-j|}x_mx_{m+|i-j|},1\leqslant i,j\leqslant L.
\end{equation}
Тогда 
\begin{equation*}
    \bfX=\sum_{i=1}^L\sigma_i P_iQ_i^\rmT = \bfX_1+\ldots \bfX_L,
\end{equation*}
где $Q_i = \bfX P_i/\sigma_i$, $\sigma_i= \|\bfX P_i\|$.
Такое разложение представляется более естественным для стационарных временных рядов, когда $\bfC$ является оценкой автоковариационной матрицы.

\podrazdel{Monte Carlo SSA~\cite{AllenSmith96}}
Рассмотрим задачу поиска сигнала во временном ряде. Модель:
\[
    \tX=\tS + \boldsymbol\xi,
\]
где $\tS$ -- сигнал, $\boldsymbol\xi$ -- красный шум с параметрами $\varphi$ и $\delta$. Тогда нулевая гипотеза $H_0:\tS=0$ и альтернатива $H_1:\tS\ne0$.

Зафиксируем длину окна $L$ и обозначим траекторную матрицу ряда $\boldsymbol\xi$ как $\mathbf\Xi$. Рассмотрим вектор $W\in\mathbb R^L$ единичной длины, называемый проекционным вектором. Введем величину
\[
    p=\|\mathbf\Xi^\rmT W\|^2.
\]
Статистикой критерия является величина
\[
    \widehat p = \|\bfX^\rmT W\|^2.
\]
Распределение статистики критерия оценивается с помощью моделирования согласно нулевой гипотезе; отсюда и название метода.

Если вектор $W$ -- синусоида с частотой $\omega$, то $\widehat{p}$ отражает вклад частоты $\omega$ в исходный ряд. Так как частота ожидаемого сигнала неизвестна, но необходимо рассматривать несколько векторов $W_k$, $k=1,\ldots,H$. Решение возникающей при этой проблемы множественного тестирования рассматривается в~\cite{Golyandina2023}. 
Гипотеза об отсутствии сигнала отвергается, если хотя бы для одного вектора $W=W_k$ значение $\widehat p$ оказывается значимым. %Если связать каждый вектор с частотой, то

%Далее строится доверительный интервал случайной величины $p$: в большинстве случаев распределение $p$ неизвестно, поэтому оно оценивается методом Монте-Карло.

%Построив доверительный интервал, проверяется, лежит ли $\widehat p$ в нем. Если нет, гипотеза отвергается.

%Стоит отметить, что данный критерий является несостоятельным против $H_1$, если частота $\omega$ сигнала $\tS$ неизвестна, что не редкость на практике.

%Поэтому вместо одного вектора $W$ рассматривают набор $W_k$ и для каждого такого вектора строят доверительные интервалы. Без поправки на множественные сравнения данный вариант дает радикальный критерий. В работе~[TODO] был представлен модифицированный алгоритм построения критерия в случае множественного тестирования.

Еще одним параметром MC-SSA является способ выбора векторов $W_k$. В данной работе в качестве векторов для проекции берутся собственные векторы матрицы $\bfC$, определенная в~\eqref{eq:toeplitz}. Такой способ выбора самый распространенный, поскольку, если есть значимые векторы, можно восстановить сигнал с помощью SSA на их основе. Но этот вариант, вообще говоря, дает радикальный критерий, поскольку $W_k$ зависят от ряда $\tX$, в котором мы ищем сигнал. С помощью эмпирической поправки неточных критериев можно бороться с этой проблемой. Опишем ее в следующем разделе.
\podrazdel{Поправка неточных критериев}
Данный алгоритм позволяет преобразовывать радикальные и консервативные статистические критерии в точные.

Зафиксируем нулевую гипотезу $H_0$, уровень значимости $\alpha^*$, количество выборок $M$ для оценки $\alpha_I(\alpha)$ и их объем $N$ (в случае временных рядов $N$ -- длина ряда).

Сначала моделируется $M$ выборок объема $N$ при верной $H_0$. Затем по моделированным данным строится зависимость ошибки первого рода от уровня значимости $\alpha_I(\alpha)$. Результатом работы алгоритма является формальный уровень значимости $\widetilde{\alpha}^*=\alpha_I^{-1}(\alpha^*)$. Критерий с таким уровнем значимости является асимптотически точным при $M\to\infty$.

Заметим, что если критерий сильно радикальный, то функция $\alpha_I(\alpha)$ имеет большую производную в нуле, что существенно затрудняет оценку $\alpha_I^{-1}(\alpha^*)$.

\podrazdel{ROC-кривая}
ROC-кривая -- это кривая, задаваемая параметрически:
\[
		\begin{cases}
			x=\alpha_I(\alpha) \\
			y=\beta(\alpha)
		\end{cases},\quad \alpha\in[0,1],
\]
где $\alpha_I(\alpha)$ -- функция зависимости ошибки первого рода $\alpha_I$ от уровня значимости $\alpha$, $\beta(\alpha)$ -- функция зависимости мощности $\beta$ от уровня значимости $\alpha$.

С помощью ROC-кривых можно сравнивать по потенциальной мощности неточные критерии. Отметим, что для точного (в частности, поправленного) критерия ROC-кривая совпадает с графиком мощности, так как $\alpha_I(\alpha)=\alpha$.

\razdel{Зависимость радикальности и мощности MC-SSA от параметра $L$}\label{sect:dependence}
Поскольку рассматриваемый вариант критерия MC-SSA является радикальным, существует проблема выбора такой длины окна $L$, которая дает максимально мощный критерий, но при этом не слишком радикальный, чтобы можно было применить поправку. 

Рассмотрим пример: пусть дана модель
\[
    \tX=\tS+\boldsymbol{\xi},
\]
где $\tS=\{A\cos(2\pi\omega n)\}_{n=1}^N$ -- сигнал с частотой $\omega = 0.075$, а $\boldsymbol{\xi}$ -- красный шум с параметрами $\varphi=0.7$ и $\delta=1$. Длина ряда равна $N=100$. Рассмотрим следующие нулевую гипотезу и альтернативу: $H_0:A=0$, $H_1:A=1$. В работе~\cite{cps22} было показано, что оценка параметров модели почти не искажает критерий после применения алгоритма поправки, поэтому будем предполагать, что параметры красного шума нам известны.
\Figure{0.5\textwidth}{./img/alphaI1.pdf}{Ошибка I рода\label{alphaI_phi7} ($N=100$, $\varphi=0.7$)}
\Figure{0.5\textwidth}{./img/roc1.pdf}{ROC-кривая\label{roc_phi7} ($N=100$, $\varphi=0.7$)}

По графику ошибок первого рода на рис.~\ref{alphaI_phi7} видно, что чем больше $L$, тем более радикальным становится критерий. На рис.~\ref{roc_phi7} изображены ROC-кривые критериев, наибольшую мощность дает критерий с $L=90$. На этом примере видно, что, в целом, чем сильнее радикальность критерия, тем более мощным он является после поправки.

Посмотрим на другой пример. Рассмотрим теперь красный шум с параметрами $\varphi=0.35$ и $\delta=1$ и увеличим длину ряда до $N=200$. Для удобства сравнения ROC-кривых, уменьшим амплитуду сигнала до $A=0.6$ при верной $H_1$.
\Figure{0.5\textwidth}{./img/alphaI2.pdf}{Ошибка I рода\label{alphaI_phi3} ($N=200$, $\varphi=0.35$)}
\Figure{0.5\textwidth}{./img/roc2.pdf}{ROC-кривая\label{roc_phi3} ($N=200$, $\varphi=0.35$)}

ROC-кривую для этого примера на рис.~\ref{roc_phi3} не удалось построить полностью для $L=160$ и $L=190$ из-за сильной радикальности, это видно на рис.~\ref{alphaI_phi3}.

Рядом других численных примеров было подтверждено, что с увеличением $L$ радикальность критерия сильно растет, а мощность, в целом, растет, но несильно. Это верно для разных длин ряда, для разных параметров красного шума и сигнала.

\razdel{Алгоритм поиска оптимального $L$}
В примере с $\varphi=0.35$ из-за слишком сильной радикальности было невозможно применить поправку для $L=160$, $190$. Поэтому идея выбора длины окна $L$ состоит в том, чтобы найти такое $L$, при котором ошибка первого рода не больше, чем заданная.

Учитывая, что с увеличением $L$ растет радикальность исходного критерия и мощность поправленного, предлагаем алгоритм поиска оптимальной длины окна, для которой ошибка I рода критерия не превосходит порогового значения. Фактически, сам алгоритм представляет собой бинарный поиск, однако для определенности мы его опишем формально.

\textbf{Вход алгоритма.} Временной ряд $\tX$, уровень значимости $\alpha^*$, порог ошибки первого рода $\widehat\alpha_I$ при уровне значимости $\alpha^*$, интервал $[L_{\text{left}}, L_{\text{right}}]$ поиска оптимального $L$, желаемая точность $\varepsilon$ по $\alpha_I$ и точность $\delta_L$ по $L$.

\textbf{Выход алгоритма.} Оптимальная длина окна $L_\text{optim}$:
\[
    \left|L_\text{optim} - \mathrm{argmax}\left\{L\in[L_\text{left}, L_{\text{right}}]:|\alpha_I^{(L)} - \widehat{\alpha}_I|<\varepsilon\right\}\right| \leqslant \delta_L.
\]

\begin{enumerate}
    \item Вычислить $\alpha_I^{(L_\text{left})}$ и $\alpha_I^{(L_\text{right})}$. Если $\alpha_I^{(L_\text{right})} \leqslant \widehat\alpha_I$, завершить алгоритм с $L_\text{optim}=L_\text{right}$. Иначе, если $|\alpha_I^{(L_\text{left})} - \widehat{\alpha}_I| < \varepsilon$, завершить алгоритм с $L_\text{optim}=L_\text{left}$. Иначе, если $\alpha_I^{(L_\text{left})} > \widehat{\alpha}_I$, оптимальной длины окна на этом интервале нет, завершить алгоритм.
    \item Вычислить $\alpha_I^{(L_\text{mid})}$, где $L_\text{mid}=\lfloor(L_\text{left}+L_\text{right})/2\rfloor$. Если \\$|\alpha_I^{(L_\text{mid})} - \widehat\alpha_I| < \varepsilon$, завершить алгоритм с $L_\text{optim}=L_\text{mid}$. Иначе, если $\alpha_I^{(L_\text{mid})} < \widehat{\alpha}_I$, $L_\text{left}=L_\text{mid}$. Если $\alpha_I^{(L_\text{mid})} > \widehat{\alpha}_I$, $L_\text{right}=L_\text{mid}$.
    \item Если $|\alpha_I^{(L_\text{mid})} - \widehat\alpha_I| \geqslant \varepsilon$, повторить пункт 2 до тех пор, пока $L_\text{left} < L_\text{right} - \delta_L$.
    \item Если $L_\text{left} \geqslant L_\text{right} -  \delta_L$, завершить алгоритм с $L_\text{optim}=L_\text{left}$.
\end{enumerate}

\podrazdel{Проверка работы алгоритма}
\Figure{0.5\textwidth}{./img/roc2_optim.pdf}{ROC-кривая\label{roc_phi3_optim} ($N=200$, $\varphi=0.35$), $L_\text{optim}=142$}
Проверим работу алгоритма на примере c $\varphi=0.35$ и $N=200$ из раздела~3. Поиск $L_\text{optim}$ велся на интервале $[100, 190]$ со следующими параметрами: $\alpha^*=0.05$, $\widehat\alpha_I = 0.5$, $\varepsilon=0.01$ и $\delta_L = 5$. Результат алгоритма: $L_\text{optim}=142$ с $\alpha_I^{(L_\text{optim})}=0.49$.
По рис.~\ref{roc_phi3_optim} изображены ROC-кривые критериев с добавлением $L_\text{optim}$. Как видно, ROC-кривую для $L_\text{optim}$ уже удалось построить и такая длина окна действительно оптимальна.

\razdel{Заключение}
В работе предложен способ выбора параметра <<длина окна>> в методе MC-SSA, позволяющем обнаруживать сигнал в красном шуме. На основе численно выявленных закономерностей был построен алгоритм, позволяющий выбрать длину окна, приводящую к построению точного критерия, возможного на практике, и при этом наиболее мощного.

При демонстрации алгоритма мы предполагали, что значения параметров красного шума известны, однако их оценивание не искажает выявленные закономерности, лежащие в основе алгоритма.
%%%% Список литературы должен быть оформлен по следующему образцу:
\begin{thebibliography}{40}
    \bibitem{cps23} Селиверстова~К.\:А. Применение статистических методов для оценки глобального потепления // Процессы управления и устойчивость. 2023. T. 10. №~1. С.~195--199.
    \bibitem{AllenSmith96} Allen~M., Smith~L. Monte Carlo SSA: detecting irregular oscillations in the presence of coloured noise // Journal of Climate. 1996. Vol.~9. P.~3373–-3404.
    \bibitem{Golyandina2023} Golyandina~N. Detection of signals by Monte Carlo singular spectrum analysis: multiple testing // Statistics and Its Interface. 2023. Vol~16. №~1. P.~147--157.
    \bibitem{cps22} Ларин~Е.\:С. Применимость исправления статистических критериев на примере задачи обнаружения сигнала во временных рядах // Процессы управления и устойчивость. 2022. T. 9. №~1. С.~267--271.
    \bibitem{ssa2001} Golyandina~N., Nekrutkin~V., Zhigljavsky~A. Analysis of Time Series Structure: SSA and Related Techniques. Chapman and Hall/CRC, 2001.
\end{thebibliography}
\end{document}
